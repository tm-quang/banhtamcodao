-- Enable UUID extension if needed (optional, but good practice)
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- 1. Table: accounts
CREATE TABLE "accounts" (
  "id" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "username" TEXT NOT NULL UNIQUE,
  "password_hash" TEXT NOT NULL,
  "role" TEXT NOT NULL DEFAULT 'customer' CHECK (role IN ('customer', 'admin')),
  "status" TEXT NOT NULL DEFAULT 'active' CHECK (status IN ('active', 'inactive')),
  "reset_token" TEXT,
  "reset_token_expires" TIMESTAMP,
  "created_at" TIMESTAMP DEFAULT NOW(),
  "updated_at" TIMESTAMP DEFAULT NOW()
);

-- 2. Table: announcements
CREATE TABLE "announcements" (
  "id" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "title" TEXT NOT NULL,
  "content" TEXT NOT NULL,
  "is_active" BOOLEAN DEFAULT TRUE,
  "created_at" TIMESTAMP DEFAULT NOW()
);

-- 3. Table: categories
CREATE TABLE "categories" (
  "id" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "parent_id" BIGINT REFERENCES "categories" ("id") ON DELETE SET NULL,
  "name" TEXT NOT NULL,
  "slug" TEXT UNIQUE,
  "created_at" TIMESTAMP DEFAULT NOW(),
  "updated_at" TIMESTAMP DEFAULT NOW()
);

-- 4. Table: customers
CREATE TABLE "customers" (
  "id" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "account_id" BIGINT NOT NULL UNIQUE REFERENCES "accounts" ("id") ON DELETE CASCADE,
  "full_name" TEXT NOT NULL,
  "phone_number" TEXT UNIQUE,
  "email" TEXT UNIQUE,
  "shipping_address" TEXT,
  "city" TEXT,
  "district" TEXT,
  "reward_points" INTEGER NOT NULL DEFAULT 0,
  "created_at" TIMESTAMP DEFAULT NOW(),
  "updated_at" TIMESTAMP DEFAULT NOW()
);

-- 5. Table: display_campaigns
CREATE TABLE "display_campaigns" (
  "id" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "name" TEXT NOT NULL,
  "type" TEXT NOT NULL CHECK (type IN ('banner', 'notification')),
  "display_location" TEXT NOT NULL CHECK (display_location IN ('product_detail', 'home_popup', 'cart_page')),
  "content" TEXT,
  "image_url" TEXT,
  "status" TEXT NOT NULL DEFAULT 'inactive' CHECK (status IN ('active', 'inactive')),
  "start_date" TIMESTAMP,
  "end_date" TIMESTAMP,
  "created_at" TIMESTAMP DEFAULT NOW()
);

-- 6. Table: orders
CREATE TABLE "orders" (
  "id" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "order_code" TEXT NOT NULL UNIQUE,
  "recipient_name" TEXT NOT NULL,
  "phone_number" TEXT NOT NULL,
  "delivery_address" TEXT NOT NULL,
  "items_list" TEXT NOT NULL, -- Storing JSON string as TEXT, could be JSONB
  "note" TEXT,
  "subtotal" NUMERIC(10,2) NOT NULL,
  "shipping_fee" NUMERIC(10,2) NOT NULL DEFAULT 0.00,
  "promo_code" TEXT,
  "discount_amount" NUMERIC(10,2) DEFAULT 0.00,
  "total_amount" NUMERIC(10,2) NOT NULL,
  "delivery_method" TEXT NOT NULL,
  "payment_status" TEXT NOT NULL DEFAULT 'unpaid',
  "delivery_date" DATE NOT NULL,
  "delivery_time" TIME NOT NULL,
  "status" TEXT DEFAULT 'Chờ xác nhận' CHECK (status IN ('Chờ xác nhận', 'Đã xác nhận', 'Đang vận chuyển', 'Hoàn thành', 'Đã hủy')),
  "order_time" TIMESTAMP NOT NULL,
  "created_at" TIMESTAMP DEFAULT NOW()
);

-- 7. Table: products
CREATE TABLE "products" (
  "id" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "category_id" BIGINT REFERENCES "categories" ("id") ON DELETE SET NULL,
  "name" TEXT NOT NULL,
  "slug" TEXT UNIQUE,
  "description" TEXT,
  "image_url" TEXT,
  "price" NUMERIC(10,2) NOT NULL,
  "discount_price" NUMERIC(10,2),
  "promo_text" TEXT,
  "promo_quantity" INTEGER,
  "promo_discount_percent" INTEGER,
  "status" TEXT DEFAULT 'active' CHECK (status IN ('active', 'inactive', 'hidden')),
  "is_special" BOOLEAN DEFAULT FALSE,
  "created_at" TIMESTAMP DEFAULT NOW(),
  "updated_at" TIMESTAMP DEFAULT NOW()
);

-- 8. Table: product_attributes
CREATE TABLE "product_attributes" (
  "id" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "product_id" BIGINT NOT NULL REFERENCES "products" ("id") ON DELETE CASCADE,
  "attribute_name" TEXT NOT NULL,
  "attribute_value" TEXT NOT NULL,
  "extra_price" NUMERIC(10,2) DEFAULT 0.00
);

-- 9. Table: product_images
CREATE TABLE "product_images" (
  "id" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "product_id" BIGINT NOT NULL REFERENCES "products" ("id") ON DELETE CASCADE,
  "image_url" TEXT NOT NULL
);

-- 10. Table: product_options
CREATE TABLE "product_options" (
  "id" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "product_id" BIGINT NOT NULL REFERENCES "products" ("id") ON DELETE CASCADE,
  "option_group" TEXT NOT NULL DEFAULT 'Topping',
  "option_name" TEXT NOT NULL,
  "extra_price" NUMERIC(10,2) DEFAULT 0.00
);

-- 11. Table: product_reviews
CREATE TABLE "product_reviews" (
  "id" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "product_id" BIGINT NOT NULL REFERENCES "products" ("id") ON DELETE CASCADE,
  "customer_id" BIGINT REFERENCES "customers" ("id") ON DELETE SET NULL,
  "product_name" TEXT,
  "customer_name" TEXT NOT NULL,
  "rating" SMALLINT NOT NULL,
  "comment" TEXT,
  "status" TEXT NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'approved', 'rejected')),
  "is_verified_purchase" BOOLEAN NOT NULL DEFAULT FALSE,
  "created_at" TIMESTAMP DEFAULT NOW()
);

-- 12. Table: promotions
CREATE TABLE "promotions" (
  "id" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "promo_code" TEXT NOT NULL UNIQUE,
  "title" TEXT NOT NULL,
  "description" TEXT,
  "discount_type" TEXT NOT NULL CHECK (discount_type IN ('percent', 'fixed', 'free_shipping')),
  "discount_value" NUMERIC(10,2) NOT NULL,
  "min_order_value" NUMERIC(10,2) DEFAULT 0.00,
  "usage_limit" INTEGER DEFAULT 0,
  "used_count" INTEGER DEFAULT 0,
  "start_date" TIMESTAMP NOT NULL,
  "end_date" TIMESTAMP NOT NULL,
  "status" TEXT DEFAULT 'active' CHECK (status IN ('active', 'inactive', 'expired')),
  "created_at" TIMESTAMP DEFAULT NOW(),
  "updated_at" TIMESTAMP DEFAULT NOW()
);

-- 13. Table: promotion_usage_history
CREATE TABLE "promotion_usage_history" (
  "id" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "promotion_id" BIGINT NOT NULL REFERENCES "promotions" ("id") ON DELETE CASCADE,
  "order_id" BIGINT NOT NULL REFERENCES "orders" ("id") ON DELETE CASCADE,
  "customer_phone" TEXT NOT NULL,
  "used_at" TIMESTAMP DEFAULT NOW()
);

-- 14. Table: review_votes
CREATE TABLE "review_votes" (
  "id" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "review_id" BIGINT NOT NULL REFERENCES "product_reviews" ("id") ON DELETE CASCADE,
  "account_id" BIGINT NOT NULL REFERENCES "accounts" ("id") ON DELETE CASCADE,
  "vote_type" TEXT NOT NULL DEFAULT 'up' CHECK (vote_type IN ('up', 'down')),
  "created_at" TIMESTAMP DEFAULT NOW(),
  UNIQUE("review_id", "account_id")
);

-- 15. Table: settings
CREATE TABLE "settings" (
  "setting_key" TEXT PRIMARY KEY,
  "setting_value" TEXT
);

-- 16. Table: site_content
CREATE TABLE "site_content" (
  "id" BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "element_key" TEXT NOT NULL UNIQUE,
  "content_value" JSONB NOT NULL, -- Using JSONB for better JSON handling
  "description" TEXT,
  "updated_at" TIMESTAMP DEFAULT NOW()
);

-- DATA MIGRATION

-- accounts
INSERT INTO "accounts" ("id", "username", "password_hash", "role", "status", "reset_token", "reset_token_expires", "created_at", "updated_at") VALUES
(1, 'banhtamcodao', '$2b$10$tD/YQ909QYTSo6Kp0dI0kOF7lVdnlBXlPDYKFARr3evKYpQBvNgPK', 'admin', 'active', NULL, NULL, '2025-08-30 02:19:56', '2025-08-30 02:24:54'),
(2, 'minhquang030', '$2b$10$olBSbMFaQ6yxbqeN5YevMOsUnxZL4qKMCKbGnm41hJRbPCwQQaVP2', 'admin', 'active', 'cc9e30a223fd54801c859f9ab182ed896d5db298f85d3b797f59cbf9b83c49a3', '2025-09-07 13:47:20', '2025-08-30 02:30:36', '2025-09-07 12:47:20'),
(3, 'minh', '$2b$10$olBSbMFaQ6yxbqeN5YevMOsUnxZL4qKMCKbGnm41hJRbPCwQQaVP2', 'customer', 'active', NULL, NULL, '2025-08-31 18:19:05', '2025-10-04 12:18:00'),
(4, 'tang', '$2b$10$olBSbMFaQ6yxbqeN5YevMOsUnxZL4qKMCKbGnm41hJRbPCwQQaVP2', 'customer', 'active', NULL, NULL, '2025-09-01 11:13:17', '2025-10-04 12:18:03'),
(5, 'beo', '$2b$10$znGriwpHLAEKN1empN.aOOka/5jIwTKjG2210Ffj.H82epc5qxRay$2b$10$olBSbMFaQ6yxbqeN5YevMOsUnxZL4qKMCKbGnm41hJRbPCwQQaVP2', 'customer', 'active', NULL, NULL, '2025-09-04 20:40:07', '2025-10-04 12:18:05'),
(6, 'vana', '$2b$10$5BKFb0cgVeQaJHzUesmRwejORIrGoH5Wm835/XDGebkLbSK0Bd5Sm', 'customer', 'active', NULL, NULL, '2025-09-07 12:37:55', '2025-09-07 12:37:55'),
(7, '323', '$2b$10$/7/xeMnYStc1fMekBsWrPO5YNk6sEkXRIFZqJ0k5Z2lAsAODCftdO', 'customer', 'active', NULL, NULL, '2025-10-03 10:31:03', '2025-10-03 10:31:03');

-- categories
INSERT INTO "categories" ("id", "parent_id", "name", "slug", "created_at", "updated_at") VALUES
(1, NULL, 'Bánh Tằm', 'banh-tam', '2025-08-24 13:30:36', '2025-09-07 12:31:00'),
(2, 1, 'Món Phụ', 'mon-phu', '2025-08-24 13:30:47', '2025-09-07 12:31:05'),
(3, NULL, 'Thức Uống', 'thuc-uong', '2025-08-24 13:31:10', '2025-09-07 12:31:09'),
(4, 3, 'Trà Sữa', 'tra-sua', '2025-08-24 13:31:21', '2025-09-07 12:31:12'),
(5, 2, 'Ăn Vặt', 'cac-mon-an-vat', '2025-09-07 12:31:29', '2025-09-07 12:31:29');

-- customers
INSERT INTO "customers" ("id", "account_id", "full_name", "phone_number", "email", "shipping_address", "city", "district", "reward_points", "created_at", "updated_at") VALUES
(1, 1, 'Bánh Tằm Cô Đào - Admin', '0933960788', 'banhtamcodao@gmail.com', NULL, NULL, NULL, 5000, '2025-08-30 02:27:13', '2025-09-04 17:56:27'),
(2, 2, 'Trần Minh Quang', '0394181140', 'minhquang030@gmail.com', 'Cảng An Thới', 'An Giang', 'Phú Quốc', 0, '2025-08-30 02:30:36', '2025-08-31 15:10:05'),
(3, 3, 'Minh', '0931311311', 'minh@gmail.com', NULL, NULL, NULL, 0, '2025-08-31 18:19:05', '2025-08-31 18:19:05'),
(4, 4, 'Tăng', '0123999110', 'tang@gmail.com', 'Chợ củ', NULL, NULL, 0, '2025-09-01 11:13:17', '2025-09-05 11:28:24'),
(5, 5, 'Beo', '0278888111', NULL, NULL, NULL, NULL, 0, '2025-09-04 20:40:07', '2025-09-04 20:40:07'),
(6, 6, 'nguyen van a', '0111111111', '1@2.com', NULL, NULL, NULL, 0, '2025-09-07 12:37:55', '2025-09-07 12:50:55'),
(7, 7, '323', '323232', '2323@gmail.com', NULL, NULL, NULL, 0, '2025-10-03 10:31:03', '2025-10-03 10:31:03');

-- display_campaigns
INSERT INTO "display_campaigns" ("id", "name", "type", "display_location", "content", "image_url", "status", "start_date", "end_date", "created_at") VALUES
(1, 'Giảm giá khai trương', 'notification', 'product_detail', 'Giảm 10% khi mua từ 3 phần', NULL, 'active', '2025-09-06 23:24:00', '2025-09-13 23:24:00', '2025-09-06 16:24:55'),
(3, 'Popup', 'banner', 'home_popup', NULL, '/assets/images/banner-logo/campaign-1757244419097-banner-index.jpg', 'active', '2025-09-05 12:33:00', '2025-09-12 12:33:00', '2025-09-06 16:33:55'),
(4, 'Miễn phí ship', 'notification', 'product_detail', 'FREESHIP cho đơn hàng từ 50K (*)', NULL, 'active', '2025-09-07 12:51:00', '2025-09-14 12:51:00', '2025-09-07 05:52:07');

-- orders
INSERT INTO "orders" ("id", "order_code", "recipient_name", "phone_number", "delivery_address", "items_list", "note", "subtotal", "shipping_fee", "promo_code", "discount_amount", "total_amount", "delivery_method", "payment_status", "delivery_date", "delivery_time", "status", "order_time", "created_at") VALUES
(26, 'DH-09250001', 'Quang', '0394181140', 'Bánh Tằm Cô Đào', '{"name":"Bánh tằm chay","qty":1,"totalPrice":24000}|||{"name":"Cafe đá","qty":1,"totalPrice":17000}', NULL, 41000.00, 0.00, NULL, 0.00, 41000.00, 'Đến lấy', 'paid', '2025-09-07', '08:30:00', 'Hoàn thành', '2025-09-07 10:35:02', '2025-09-07 03:35:02'),
(27, 'DH-09250002', 'Hùng', '011111111', 'Bánh Tằm Cô Đào', '{"name":"Bánh tằm cay","qty":1,"totalPrice":35000}|||{"name":"Matcha latte","qty":1,"totalPrice":18000}|||{"name":"Trà tắc","qty":1,"totalPrice":15000}', NULL, 68000.00, 0.00, NULL, 0.00, 68000.00, 'Đến lấy', 'paid', '2025-09-07', '08:30:00', 'Hoàn thành', '2025-09-07 12:49:14', '2025-09-07 05:49:14'),
(28, 'DH-09250003', 'Nhật Minh', '0933960788', 'Bánh Tằm Cô Đào', '{"name":"Bánh Tằm Bì","qty":1,"totalPrice":26000}|||{"name":"Matcha latte","qty":2,"totalPrice":36000}|||{"name":"Bánh tằm cay","qty":1,"totalPrice":35000}|||{"name":"Bánh tằm chay","qty":1,"totalPrice":24000}|||{\"name\":\"Trà tắc\",\"qty\":1,\"totalPrice\":15000}|||{\"name\":\"Trà đào\",\"qty\":1,\"totalPrice\":18000}', NULL, 154000.00, 0.00, 'VIP', 77000.00, 77000.00, 'Đến lấy', 'paid', '2025-09-10', '10:30:00', 'Hoàn thành', '2025-09-09 02:06:29', '2025-09-08 19:06:29'),
(29, 'DH-10250004', 'Quang', '0394181140', 'Test', '{"name":"Bánh tằm bì xíu mại","qty":1,"totalPrice":32000}|||{"name":"Cocacola","qty":1,"totalPrice":10000}|||{"name":"Bánh Tằm Bì","qty":1,"totalPrice":26000}', NULL, 68000.00, 10000.00, NULL, 0.00, 78000.00, 'Giao tận nơi', 'paid', '2025-10-04', '11:30:00', 'Hoàn thành', '2025-10-03 23:21:20', '2025-10-03 16:21:20');

-- products
INSERT INTO "products" ("id", "category_id", "name", "slug", "description", "image_url", "price", "discount_price", "promo_text", "promo_quantity", "promo_discount_percent", "status", "is_special", "created_at", "updated_at") VALUES
(1, 1, 'Bánh Tằm Bì', 'banh-tam-bi', NULL, 'https://res.cloudinary.com/dgoe8cra8/image/upload/v1759491677/rzwnunxwdxc1uq3himrt.webp', 26000.00, 25000.00, 'Bánh Tằm Bì', NULL, NULL, 'active', TRUE, '2025-08-24 13:41:43', '2025-10-03 22:23:06'),
(2, 1, 'Bánh tằm bì xíu mại', 'banh-tam-bi-xiu-mai', NULL, 'https://res.cloudinary.com/dgoe8cra8/image/upload/v1759491658/fqpemlcplpwfqkkpu9ry.webp', 32000.00, NULL, NULL, NULL, NULL, 'active', TRUE, '2025-08-24 13:45:31', '2025-10-03 22:21:27'),
(10, 3, 'Trà đào', 'tra-dao', 'Trà đào', 'https://res.cloudinary.com/dgoe8cra8/image/upload/v1759491641/n2eqogdoganlmnarebn1.png', 18000.00, NULL, NULL, NULL, NULL, 'active', TRUE, '2025-08-26 11:36:44', '2025-10-13 23:18:59'),
(13, 3, 'Cocacola', 'cocacola', NULL, 'https://res.cloudinary.com/dgoe8cra8/image/upload/v1759491614/h0hcepfnfwbmbfggewqs.webp', 10000.00, 80000.00, NULL, NULL, NULL, 'active', TRUE, '2025-08-26 11:54:26', '2025-10-04 00:32:41');

-- product_options
INSERT INTO "product_options" ("id", "product_id", "option_group", "option_name", "extra_price") VALUES
(10, 1, 'Topping', 'Bánh Tằm', 5000.00),
(11, 1, 'Topping', 'Xíu Mại', 10000.00);

-- product_reviews
INSERT INTO "product_reviews" ("id", "product_id", "customer_id", "product_name", "customer_name", "rating", "comment", "status", "is_verified_purchase", "created_at") VALUES
(1, 1, NULL, NULL, 'Quang', 5, 'Ngon', 'approved', FALSE, '2025-09-06 00:02:59'),
(5, 1, NULL, NULL, 'Tèo', 5, 'Nước mắm ngon.nước dừa béo', 'approved', FALSE, '2025-09-06 13:55:39'),
(6, 1, NULL, NULL, 'Yu', 5, 'Hhhj\nL', 'approved', FALSE, '2025-09-06 14:01:04'),
(13, 2, NULL, NULL, 'Tùng', 5, 'Ngon', 'approved', FALSE, '2025-09-14 03:28:13'),
(14, 1, NULL, NULL, 'Tèo', 5, 'Ngon sẽ ủng hộ tiếp', 'approved', FALSE, '2025-10-04 01:04:56'),
(15, 1, NULL, NULL, '23', 5, '23232', 'approved', FALSE, '2025-10-04 01:28:20'),
(16, 1, NULL, NULL, '424', 5, '2424', 'approved', FALSE, '2025-10-04 01:28:24'),
(17, 1, NULL, NULL, '2424', 5, '2424', 'approved', FALSE, '2025-10-04 01:28:27'),
(18, 1, NULL, NULL, 'Minh', 5, 'Ngon bổ rẻ', 'approved', FALSE, '2025-10-04 01:33:51'),
(19, 1, NULL, NULL, 'Tyuu', 5, 'Ghh', 'approved', FALSE, '2025-10-15 21:51:56');

-- promotions
INSERT INTO "promotions" ("id", "promo_code", "title", "description", "discount_type", "discount_value", "min_order_value", "usage_limit", "used_count", "start_date", "end_date", "status", "created_at", "updated_at") VALUES
(1, 'FREESHIP', 'Miễn phí ship', 'Miễn phí ship', 'free_shipping', 10000.00, 50000.00, 5, 2, '2025-09-04 00:22:00', '2025-09-20 01:22:00', 'active', '2025-09-04 22:23:01', '2025-09-04 23:02:03'),
(2, 'BANHTAM20', 'Khai Trương', 'BANHTAM5', 'fixed', 5000.00, 0.00, 5, 1, '2025-09-03 18:28:00', '2025-09-10 18:28:00', 'active', '2025-09-04 22:28:45', '2025-09-04 23:24:16'),
(3, 'BANHTAMCODAO', 'KHAI TRƯƠNG', 'KHAI TRƯƠNG', 'percent', 5.00, 30000.00, 50, 1, '2025-09-04 08:35:00', '2025-11-05 08:35:00', 'active', '2025-09-05 12:35:45', '2025-10-03 23:56:35'),
(4, 'VIP', 'VIP', 'VIP', 'percent', 50.00, 100000.00, 100, 1, '2025-09-09 02:05:00', '2025-09-12 02:05:00', 'active', '2025-09-09 02:05:12', '2025-09-09 02:06:29');

-- promotion_usage_history
INSERT INTO "promotion_usage_history" ("id", "promotion_id", "order_id", "customer_phone", "used_at") VALUES
(2, 4, 28, '0933960788', '2025-09-09 02:06:29');

-- review_votes
INSERT INTO "review_votes" ("id", "review_id", "account_id", "vote_type", "created_at") VALUES
(3, 6, 2, 'up', '2025-10-04 00:34:40'),
(4, 1, 2, 'up', '2025-10-04 00:34:41'),
(5, 5, 2, 'up', '2025-10-04 00:34:42');

-- settings
INSERT INTO "settings" ("setting_key", "setting_value") VALUES
('closing_time', '10:30'),
('delivery_fee', '10000'),
('opening_time', '06:00'),
('payment_cod_enabled', '1'),
('payment_transfer_enabled', '1'),
('store_address', 'Ngã 5 cảng An Thới, Khu 1, Phường An Thới, Đặc Khu Phú Quốc'),
('store_email', 'banhtamcodao@gmail.com'),
('store_name', 'Bánh Tằm Cô Đào'),
('store_phone', '0933 960 788'),
('vat_tax', '8');

-- site_content
INSERT INTO "site_content" ("id", "element_key", "content_value", "description", "updated_at") VALUES
(1, 'homepage_slideshow', '["/assets/images/banner-logo/campaign-1757243748372-beach.jpg","/assets/images/banner-logo/campaign-1757243748378-contac-background.jpg","/assets/images/banner-logo/campaign-1757243748385-drop.jpg"]', 'Các ảnh slideshow cho trang chủ', '2025-09-07 11:15:48'),
(2, 'menu_slideshow', '["/assets/images/banner-logo/campaign-1757243085999-drop4.jpg","/assets/images/banner-logo/campaign-1757243086000-giavi3.jpg","/assets/images/banner-logo/campaign-1757243086006-pork-slide-min.jpg"]', 'Các ảnh slideshow cho trang Menu', '2025-09-07 11:04:46');

-- Reset sequences to max id
SELECT setval(pg_get_serial_sequence('accounts', 'id'), (SELECT MAX(id) FROM accounts));
SELECT setval(pg_get_serial_sequence('categories', 'id'), (SELECT MAX(id) FROM categories));
SELECT setval(pg_get_serial_sequence('customers', 'id'), (SELECT MAX(id) FROM customers));
SELECT setval(pg_get_serial_sequence('display_campaigns', 'id'), (SELECT MAX(id) FROM display_campaigns));
SELECT setval(pg_get_serial_sequence('orders', 'id'), (SELECT MAX(id) FROM orders));
SELECT setval(pg_get_serial_sequence('products', 'id'), (SELECT MAX(id) FROM products));
SELECT setval(pg_get_serial_sequence('product_options', 'id'), (SELECT MAX(id) FROM product_options));
SELECT setval(pg_get_serial_sequence('product_reviews', 'id'), (SELECT MAX(id) FROM product_reviews));
SELECT setval(pg_get_serial_sequence('promotions', 'id'), (SELECT MAX(id) FROM promotions));
SELECT setval(pg_get_serial_sequence('promotion_usage_history', 'id'), (SELECT MAX(id) FROM promotion_usage_history));
SELECT setval(pg_get_serial_sequence('review_votes', 'id'), (SELECT MAX(id) FROM review_votes));
SELECT setval(pg_get_serial_sequence('site_content', 'id'), (SELECT MAX(id) FROM site_content));

-- Trigger for updated_at
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ language 'plpgsql';

CREATE TRIGGER update_accounts_updated_at BEFORE UPDATE ON accounts FOR EACH ROW EXECUTE PROCEDURE update_updated_at_column();
CREATE TRIGGER update_categories_updated_at BEFORE UPDATE ON categories FOR EACH ROW EXECUTE PROCEDURE update_updated_at_column();
CREATE TRIGGER update_customers_updated_at BEFORE UPDATE ON customers FOR EACH ROW EXECUTE PROCEDURE update_updated_at_column();
CREATE TRIGGER update_products_updated_at BEFORE UPDATE ON products FOR EACH ROW EXECUTE PROCEDURE update_updated_at_column();
CREATE TRIGGER update_promotions_updated_at BEFORE UPDATE ON promotions FOR EACH ROW EXECUTE PROCEDURE update_updated_at_column();
CREATE TRIGGER update_site_content_updated_at BEFORE UPDATE ON site_content FOR EACH ROW EXECUTE PROCEDURE update_updated_at_column();
